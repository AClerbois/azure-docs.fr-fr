---
title: 'Azure AD Connect : Migrer des groupes d’une forêt à une autre | Microsoft Docs'
description: Cet article décrit les étapes requises pour migrer correctement des groupes d’une forêt vers une autre pour Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: reference
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 602c60de392afbff18bc141605a936636e48dbfe
ms.sourcegitcommit: ffc6e4f37233a82fcb14deca0c47f67a7d79ce5c
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/21/2020
ms.locfileid: "81729704"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Migrer des groupes d’une forêt à une autre pour Azure AD Connect

Cet article décrit les étapes requises pour migrer correctement des groupes d’une forêt vers une autre, afin que les objets groupe migrés correspondent aux objets existants dans le cloud.

## <a name="prerequisites"></a>Prérequis

- Azure AD Connect 1.5.18.0 ou ultérieur
- Attribut d’ancrage source : `mS-DS-ConsistencyGuid`

Depuis la version 1.5.18.0, Azure AD Connect a commencé à prendre en charge l’utilisation de `mS-DS-ConsistencyGuid` pour les groupes. Si `mS-DS-ConsistencyGuid` est choisi comme attribut d’ancrage source et que la valeur est renseignée dans AD, Azure AD Connect utilise la valeur de `mS-DS-ConsistencyGuid` en tant que valeur immutableId. Dans le cas contraire, il revient à l’utilisation de `objectGUID`. Toutefois, veuillez noter qu’Azure AD Connect **NE met PAS** à jour la valeur dans l’attribut `mS-DS-ConsistencyGuid`, dans AD.

Dans le cadre d’un scénario de déplacement d’une forêt à une autre, où un objet de groupe est déplacé d’une forêt (par exemple, F1) vers une autre forêt (par exemple, F2), nous devons copier la valeur `mS-DS-ConsistencyGuid` (le cas échéant) ou la valeur `objectGUID` à partir de l’objet dans la forêt F1 vers l’attribut `mS-DS-ConsistencyGuid` de l’objet dans F2. 

Utilisez les scripts suivants comme indications pour voir comment migrer un groupe individuel de la forêt F1 vers la forêt F2. N’hésitez pas à utiliser ceci comme indication pour effectuer la migration pour plusieurs groupes.

Tout d’abord, nous obtenons les paramètres `objectGUID` et `mS-DS-ConsistencyGuid` de l’objet groupe dans la forêt F1. Ces attributs sont exportés dans un fichier CSV.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to Export-Group script
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Ensuite, nous utilisons le fichier CSV de sortie généré pour marquer l’attribut `mS-DS-ConsistencyGuid` sur l’objet cible dans la forêt F2.


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by Import-Group script
It copies either the objectGUID or mS-DS-ConsistencyGuid value from CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Étapes suivantes
En savoir plus sur l’ [intégration de vos identités locales avec Azure Active Directory](whatis-hybrid-identity.md).
