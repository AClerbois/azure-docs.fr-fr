<properties 
	pageTitle="Authentification de vos applications avec Live Connect (JavaScript)" 
	description="Découvrez comment utiliser l'authentification unique Live Connect dans Azure Mobile Services à partir d'une application Windows Store." 
	services="mobile-services" 
	documentationCenter="windows" 
	authors="ggailey777" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="mobile-services" 
	ms.workload="mobile" 
	ms.tgt_pltfrm="mobile-windows-store" 
	ms.devlang="javascript" 
	ms.topic="article" 
	ms.date="04/08/2015" 
	ms.author="glenga"/>

# Authentifier votre application Windows Phone avec l'authentification gérée par le client à l'aide du compte Microsoft

[AZURE.INCLUDE [mobile-services-selector-single-signon](../../includes/mobile-services-selector-single-signon.md)]

##Vue d'ensemble
Cette rubrique montre comment authentifier les utilisateurs dans Azure Mobile Services à partir d'une application Windows Store. Dans ce didacticiel, vous allez ajouter le processus d'authentification au projet de démarrage rapide à l'aide de Live Connect. Après avoir été authentifié par Live Connect, l'utilisateur connecté est accueilli par son nom et son ID est affiché.

>[AZURE.NOTE]Ce didacticiel présente les avantages de l'utilisation de l'authentification gérée par le client et du Kit de développement logiciel (SDK) Live. Cette fonction vous permet d'authentifier plus facilement un utilisateur déjà connecté avec votre service mobile. Vous pouvez également demander des étendues supplémentaires pour permettre à votre application d'accéder à des ressources telles que OneDrive. L'authentification gérée par le service offre une expérience plus générale et prend en charge plusieurs fournisseurs d'authentification. Pour plus d'informations sur l'authentification gérée par le service, consultez la rubrique [Ajouter l'authentification à votre application](mobile-services-windows-store-javascript-get-started-users.md).

Ce didacticiel requiert les éléments suivants :

+ [Kit de développement logiciel (SDK) Live pour Windows]
+ Microsoft Visual Studio 2012 Express pour Windows 8 RC ou version ultérieure
+ Vous devez d'abord suivre le didacticiel [Ajouter Mobile Services à une application existante].

##Inscrire votre application pour utiliser un compte Microsoft pour l'authentification

Pour pouvoir authentifier les utilisateurs, vous devez inscrire votre application auprès du Centre des développeurs de compte Microsoft. Vous devez ensuite connecter cette inscription à votre service mobile. Effectuez les étapes décrites dans la rubrique suivante pour créer une inscription de compte Microsoft et la connecter à votre service mobile.

+ [Inscrire votre application pour utiliser les informations de connexion d'un compte Microsoft](mobile-services-how-to-register-microsoft-authentication.md)

##<a name="permissions"></a>Restreindre les autorisations aux utilisateurs authentifiés

Vous devez ensuite restreindre l'accès à une ressource, en l'occurrence la table *TodoItems* pour vous assurer qu'elle ne soit accessible que par un utilisateur inscrit.

[AZURE.INCLUDE [mobile-services-restrict-permissions-windows](../../includes/mobile-services-restrict-permissions-windows.md)]

##<a name="add-authentication"></a>Ajouter l'authentification à l'application

Enfin, ajoutez le Kit de développement logiciel (SDK) Live et utilisez-le pour authentifier les utilisateurs de votre application.

1. Dans l'**Explorateur de solutions**, cliquez avec le bouton droit sur la solution, puis cliquez sur **Gérer les packages NuGet**.

2. Dans le volet gauche, sélectionnez la catégorie **En ligne**, recherchez **LiveSDK**, cliquez sur **Installer** dans le package **Live SDK**, puis acceptez les contrats de licence.

  	Le Kit de développement logiciel (SDK) Live vient s'ajouter à la solution.

3. Ouvrez le fichier projet default.html et ajoutez l'élément `<script>` suivant dans l'élément `<head>`.

        <script src="/js/wl.js"></script>

5. Dans la surcharge de la méthode **app.OnActivated**, remplacez l'appel à la méthode **refreshTodoItems** par le code suivant :
	
        // Set the mobileClient variable to client variable generated by the tooling.
        var mobileClient = <yourClient>;

        var session = null;
        var login = function () {
            return new WinJS.Promise(function (complete) {
                WL.login({ scope: "wl.basic" }).then(function (result) {
                    session = result.session;

                    WinJS.Promise.join([
                        WL.api({ path: "me", method: "GET" }),
                        mobileClient.login(result.session.authentication_token)
                    ]).done(function (results) {
                        // Build the welcome message from the Microsoft account info.
                        var profile = results[0];                            
                        var title = "Welcome " + profile.first_name + "!";
                        var message = "You are now logged in as: "
                            + mobileClient.currentUser.userId;
                        var dialog = new Windows.UI.Popups.MessageDialog(message, title);
                        dialog.showAsync().then(function () {
                            // Reload items from the mobile service.
                            refreshTodoItems();
                        }).done(complete);
                        
                    }, function (error) {

                    });
                }, function (error) {
                    session = null;
                    var dialog = new Windows.UI.Popups.MessageDialog("You must log in.", "Login Required");
                    dialog.showAsync().done(complete);
                });
            });
        }

        var authenticate = function () {
            // Block until sign-in is successful.
            login().then(function () {
                if (session === null) {
                    // Authentication failed, try again.
                    authenticate();
                }
            });
        }

		// Initialize the Live client.
        WL.init({
            redirect_uri: mobileClient.applicationUrl
        });

		// Start the sign-in process.
        authenticate();

    Cela permet d'initialiser le client Live Connect, d'envoyer une nouvelle demande de connexion à Live Connect, d'envoyer le jeton d'authentification renvoyé à Mobile Services, puis d'afficher des informations sur l'utilisateur connecté.

	>[AZURE.NOTE]Idéalement, vous ne devez pas effectuer de demande de jetons d'authentification de connexion Live ou de jetons d'autorisation Mobile Services chaque fois que votre application s'exécute. Cette méthode est non seulement inefficace, mais vous pouvez rencontrer des problèmes d'utilisation si de nombreux clients tentent de lancer votre application en même temps. Il est préférable de mettre les jetons en cache et d'essayer tout d'abord d'utiliser le jeton Mobile Services en cache avant d'appeler **LoginWithMicrosoftAccountAsync**. Pour voir un exemple de mise en cache de ce jeton, consultez [Prise en main de l'authentification](mobile-services-windows-store-javascript-get-started-users.md#tokens)
	
7. Remplacez la valeur `<yourClient>` de la première ligne du code ci-dessus par la variable définie dans le fichier .js ajouté lorsque vous avez connecté votre projet au service mobile.
		
8. Appuyez sur la touche F5 pour exécuter l'application et connectez-vous avec votre compte Microsoft.

   	Lorsque vous êtes connecté, l'application doit s'exécuter sans erreur et vous devez pouvoir exécuter des requêtes Mobile Services et mettre à jour les données.

## <a name="next-steps"> </a>Étapes suivantes

Dans le didacticiel suivant, [Autorisation des utilisateurs avec des scripts], vous allez utiliser la valeur de l'ID utilisateur fournie par Mobile Services en fonction de l'utilisateur authentifié et l'utiliser pour filtrer les données renvoyées par Mobile Services. Pour plus d'informations sur l'utilisation d'autres fournisseurs d'identité à des fins d'authentification, consultez la page [Prise en main de l'authentification].

<!-- Anchors. -->
[Register your app for authentication and configure Mobile Services]: #register
[Restrict table permissions to authenticated users]: #permissions
[Add authentication to the app]: #add-authentication
[Next Steps]: #next-steps

<!-- Images. -->

<!-- URLs. -->
[Submit an app page]: http://go.microsoft.com/fwlink/p/?LinkID=266582
[My Applications]: http://go.microsoft.com/fwlink/p/?LinkId=262039
[Kit de développement logiciel (SDK) Live pour Windows]: http://go.microsoft.com/fwlink/p/?LinkId=262253
[Ajouter Mobile Services à une application existante]: mobile-services-windows-store-javascript-get-started-data.md
[Prise en main de l'authentification]: mobile-services-windows-store-javascript-get-started-users.md
[Autorisation des utilisateurs avec des scripts]: ../mobile-services-windows-store-javascript-authorize-users-in-scripts.md

[Azure Management Portal]: https://manage.windowsazure.com/
 

<!---HONumber=July15_HO4-->