---
title: Évaluation des vulnérabilités SQL
description: Découvrez comment configurer l’évaluation des vulnérabilités SQL sur SQL Database et interpréter les rapports d’évaluation.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 02/05/2020
tags: azure-synapse
ms.openlocfilehash: 87f3c4b0489c48f758ce9e660bdfd599c086b677
ms.sourcegitcommit: 225a0b8a186687154c238305607192b75f1a8163
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/29/2020
ms.locfileid: "78191977"
---
# <a name="sql-vulnerability-assessment-service-helps-you-identify-database-vulnerabilities"></a>Le service d’évaluation des vulnérabilités SQL vous permet d’identifier des vulnérabilités de base de données

L’évaluation des vulnérabilités SQL est un service simple à configurer, qui vous permet de découvrir, suivre et vous aide à corriger des vulnérabilités de base de données potentielles. Utilisez-le pour améliorer de façon proactive la sécurité de votre base de données.

Évaluation des vulnérabilités (VA) fait partie de l'offre [Advanced Data Security](sql-database-advanced-data-security.md) (ADS) qui est un package unifié de fonctionnalités de sécurité SQL avancées. L’évaluation des vulnérabilités peut être accessible et gérée via le portail SQL Advanced Data Security central.

> [!NOTE]
> L’évaluation des vulnérabilités est prise en charge pour Azure SQL Database, Azure SQL Managed Instance et Azure Synapse Analytics. Par souci de simplicité, SQL Database est utilisé dans cet article quand l’un de ces services de bases de données managées est mentionné.

## <a name="the-vulnerability-assessment-service"></a>Le service Évaluation des vulnérabilités

Évaluation des vulnérabilités SQL (VA) est un service qui offre une visibilité de votre état de sécurité et inclut des mesures pratiques pour résoudre les problèmes de sécurité et améliorer la sécurité de votre base de données. Elle peut vous aider à :  

- Répondre aux exigences de conformité qui nécessitent des rapports d’analyse de la base de données.  
- Répondre aux normes de protection des données personnelles.  
- Effectuer le monitoring d’un environnement de base de données dynamique, dans lequel les modifications sont difficiles à suivre.  

Évaluation des vulnérabilités est un service d’analyse intégré au service Azure SQL Database. Le service utilise une base de connaissances de règles qui marquent les failles de sécurité et met en évidence les écarts par rapport aux meilleures pratiques, notamment les erreurs de configuration, les autorisations excessives et les données sensibles non protégées. Les règles sont basées sur les meilleures pratiques de Microsoft et se concentrent sur les problèmes de sécurité qui présentent des risques majeurs pour votre base de données et ses précieuses données. Elles couvrent les problèmes au niveau de la base de données ainsi que les problèmes de sécurité au niveau du serveur, comme les paramètres de pare-feu serveur et les autorisations au niveau du serveur. Elles représentent également la plupart des exigences des différentes instances réglementaires, visant au respect de leurs normes de conformité.  

Les résultats de l’analyse sont accompagnés d’étapes actionnables pour résoudre chaque problème et, le cas échéant, de scripts de correction personnalisés. Un rapport d’évaluation peut être personnalisé selon votre environnement, en définissant une ligne de base acceptable pour les configurations d’autorisations, les configurations de fonctionnalités et les paramètres de la base de données.

## <a name="implementing-vulnerability-assessment"></a>Implémentation du service Évaluation des vulnérabilités

Les étapes suivantes implémentent VA sur SQL Database.  

### <a name="1-run-a-scan"></a>1. Exécuter une analyse  

Prenez en main l’évaluation des vulnérabilités en accédant à **Advanced Data Security** sous le titre Sécurité dans le volet Azure SQL Database. Cliquez pour activer Advanced Data Security, puis cliquez sur **Sélectionner le stockage** ou sur la carte **Évaluation des vulnérabilités**, qui ouvre automatiquement la carte de paramètres d'Évaluation des vulnérabilités pour l'intégralité du serveur SQL.

Commencez par configurer un compte de stockage où seront stockés les résultats de l’analyse de toutes les bases de données sur le serveur. Pour plus d’informations sur les comptes de stockage, voir [À propos des comptes Azure Storage](../storage/common/storage-create-storage-account.md). Une fois le stockage configuré, cliquez sur **Analyser** pour rechercher d’éventuelles vulnérabilités dans votre base de données.
  
![Analyser une base de données](./media/sql-vulnerability-assessment/pp_va_initialize.png)  

  > [!NOTE]
  > L’analyse est légère et sûre. Elle met quelques secondes à s’exécuter, entièrement en lecture seule. Elle n’apporte aucune modification à la base de données.  

### <a name="2-view-the-report"></a>2. Afficher le rapport

Lorsque votre analyse est terminée, votre rapport d’analyse apparaît automatiquement dans le portail Azure. Le rapport présente une vue d’ensemble de l’état de la sécurité et indique le nombre de problèmes détectés ainsi que leur niveau de gravité respectif. Les résultats incluent des avertissements sur des écarts par rapport aux meilleures pratiques et une capture instantanée de vos paramètres de sécurité, comme les principaux et rôles de base de données et les autorisations associées. Le rapport d'analyse fournit également une carte des données sensibles détectées dans votre base de données, avec des recommandations pour classer ces données à l'aide de [Découverte et classification des données](sql-database-data-discovery-and-classification.md).

![Afficher le rapport](./media/sql-vulnerability-assessment/pp_main_getstarted.png)  

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Analyser les résultats et résoudre les problèmes

Passez en revue vos résultats et identifiez ceux qui constituent de véritables problèmes de sécurité dans votre environnement. Explorez chaque résultat ayant entraîné un échec pour comprendre son impact et pourquoi chaque vérification de sécurité a échoué. Utilisez les informations de correction actionnables fournies par le rapport pour résoudre le problème.  

![Analyser le rapport](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. Définir votre ligne de base

Lorsque vous examinez les résultats de votre évaluation, vous pouvez définir certains résultats spécifiques comme *ligne de base acceptable* dans votre environnement. La ligne de base est en somme une personnalisation du signalement des résultats. Les résultats correspondant à la ligne de base seront considérés comme corrects lors des analyses ultérieures. Une fois que l’état de sécurité de votre ligne de base a été défini, VA signale uniquement les écarts par rapport à cette ligne de base, et vous pouvez alors vous concentrer sur les problèmes pertinents.  

![Définir votre ligne de base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)  

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Exécuter une nouvelle analyse pour afficher le rapport de suivi personnalisé

Après avoir terminé la configuration des **lignes de base de votre règle**, exécutez une nouvelle analyse pour afficher le rapport personnalisé. VA signale désormais uniquement les problèmes de sécurité qui s’écartent de votre état de ligne de base approuvé.

![Afficher votre rapport personnalisé](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)  

Le service Évaluation des vulnérabilités peut désormais être utilisé pour vérifier que votre base de données conserve en permanence un haut niveau de sécurité et que les stratégies de votre entreprise sont respectées. Si des rapports de conformité sont requis, ceux de l’évaluation des vulnérabilités peuvent être utiles pour faciliter le processus de conformité.  

### <a name="6-set-up-periodic-recurring-scans"></a>6. Configurer des analyses récurrentes

Accédez aux paramètres d’évaluation des vulnérabilités pour activer les **analyses récurrentes périodiques**. Cela permet de configurer l’évaluation des vulnérabilités pour exécuter automatiquement une analyse sur votre base de données une fois par semaine. Un résumé de résultats d’analyse est envoyé aux adresses e-mail que vous fournissez.

![Afficher votre rapport personnalisé](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Exporter un rapport d’évaluation

Cliquez sur **Export Scan Results** (Exporter les résultats d’analyse) pour créer un rapport Excel téléchargeable de résultat de votre analyse. Ce rapport contient un onglet de résumé qui affiche un résumé de l’évaluation, y compris tous les contrôles qui ont échoué. Il inclut également un onglet de **résultats** contenant l’ensemble complet de résultats de l’analyse, y compris tous les contrôles qui ont été exécutés et les détails de résultat de chacun.

### <a name="8-view-scan-history"></a>8. Afficher l’historique d’analyse

Cliquez sur **Historique d’analyse** dans le volet VA pour afficher un historique de toutes les analyses précédemment exécutées sur cette base de données. Sélectionnez une analyse particulière dans la liste pour afficher les résultats détaillés de cette analyse.

Le service Évaluation des vulnérabilités peut désormais être utilisé pour vérifier que votre base de données conserve en permanence un haut niveau de sécurité et que les stratégies de votre entreprise sont respectées. Si des rapports de conformité sont requis, ceux de l’évaluation des vulnérabilités peuvent être utiles pour faciliter le processus de conformité.

## <a name="manage-vulnerability-assessments-using-azure-powershell"></a>Gérer les évaluations des vulnérabilités à l’aide d’Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> Le module PowerShell Azure Resource Manager est toujours pris en charge par Azure SQL Database, mais tous les développements futurs sont destinés au module Az.Sql. Pour ces cmdlets, voir [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Les arguments des commandes dans le module Az sont sensiblement identiques à ceux des modules AzureRm.

Vous pouvez utiliser les applets de commande Azure PowerShell pour gérer par programmation l’évaluation des vulnérabilités. Les applets de commande prises en charge sont les suivantes :

- [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting)

  Met à jour les paramètres d’évaluation des vulnérabilités d’une base de données
- [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting)

  Retourne les paramètres d’évaluation des vulnérabilités d’une base de données
- [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting)

  Efface les paramètres d’évaluation des vulnérabilités d’une base de données
- [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Obtient la ligne de base de la règle d’évaluation des vulnérabilités.
- [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Obtient la ligne de base de la règle d’évaluation des vulnérabilités pour une règle donnée.
- [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Efface la ligne de base de la règle d’évaluation des vulnérabilités. D’abord, définissez la règle de base avant d’utiliser cette applet de commande pour la supprimer.
- [Start-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan)

  Déclenche le démarrage d’une analyse d’évaluation des vulnérabilités.
- [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord)

   Obtient tous les enregistrements d’analyse d’évaluation des vulnérabilités associés à une base de données.
- [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan)

  Convertit les résultats d’analyse d’évaluation des vulnérabilités en fichier Excel.

Pour obtenir un exemple de script, consultez [Azure SQL Vulnerability Assessment PowerShell support](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/).

## <a name="manage-vulnerability-assessments-baseline-rules-using-resource-manager-templates"></a>Gérer les règles de base d’évaluation des vulnérabilités à l’aide de modèles Resource Manager

Pour configurer des règles de base d’évaluation des vulnérabilités à l’aide de modèles Azure Resource Manager, utilisez le type `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`.

Vérifiez que vous avez activé vulnerabilityAssements sur l’ordinateur qui exécute SQL Server avant d’ajouter des règles de base.

Voici un exemple de définition de la règle de base VA2065 sur masterdb et VA1143 sur userdb comme ressources dans un modèle Resource Manager :

```json
    "resources": [
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                                "FirewallRuleName3",
                                "StartIpAddress",
                                "EndIpAddress"
                                  ]
                    },{
                         "result": [
                                "FirewallRuleName4",
                                "62.92.15.68",
                                "62.92.15.68"
                            ]
                        
                    }
                ]
            },
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "dbo"
                        ]
                    }
                ]
            }
        }
    ]
}   
```

Pour la base de données utilisateur et la base de données MASTER, les noms de ressources sont définis différemment :

* Base de données MASTER - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>master</b>')]",
* Base de données utilisateur - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/<b>default</b>')]",
 
 
 Pour gérer des types <b>booléens</b> comme true/false, définissez le résultat de la règle de base avec une entrée binaire comme "1"/"0".
 
 ```json
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "1"
                        ]
                    }
                ]
            }
        }
    ]
}   
```
 
 
## <a name="next-steps"></a>Étapes suivantes  

- En savoir plus sur [Advanced Data Security](sql-database-advanced-data-security.md)
- En savoir plus sur [Découverte et classification des données](sql-database-data-discovery-and-classification.md)
